dist: trusty
sudo: required
language: go
go:
  - 1.10.x
env:
  - DB=mysql DB_VERSION=5.7
  - DB=mysql DB_VERSION=8.0

script:
  - test -d /home/travis/gopath/src/github.com/terraform-providers || mv $(dirname $PWD) /home/travis/gopath/src/github.com/terraform-providers
  - make test
  - make vet
  - make website-test
  - sudo service mysql stop
  - export MYSQL_USERNAME=root
  - export MYSQL_ENDPOINT=127.0.0.1:3306
  - export MYSQL_PASSWORD=tests
  - docker run --rm --name mysql -e MYSQL_ROOT_PASSWORD=$MYSQL_PASSWORD -d -p ${MYSQL_ENDPOING}:3306 ${DB}:${DB_VERSION}
  - while ! mysqladmin ping -uroot -h127.0.0.1 -P3306 -p${MYSQL_PASSWORD}; do echo "Sleeping for a bit..." && sleep 5; done
  - mysql -h127.0.0.1 -u{MYSQL_USERNAME} -p${MYSQL_PASSWORD} -e "INSTALL PLUGIN mysql_no_login SONAME 'mysql_no_login.so';"
  - mysql -h127.0.0.1 -u{MYSQL_USERNAME} -p${MYSQL_PASSWORD} -e "SELECT VERSION()"
  - make testacc

matrix:
  fast_finish: true
  allow_failures:
    - go: tip
